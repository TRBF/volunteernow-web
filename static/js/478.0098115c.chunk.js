"use strict";(self.webpackChunkvolunteernow_web=self.webpackChunkvolunteernow_web||[]).push([[478],{3694:(e,t,s)=>{s.d(t,{k:()=>o});var r=s(6213);const i={NODE_ENV:"production",PUBLIC_URL:"/volunteernow-web",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_BASE_URL||"https://api.volunteernow.ro/api";const o=new class{constructor(){this.api=r.A.create({baseURL:i,headers:{"Content-Type":"application/json"}}),this.logRequest=e=>{var t;console.log("[ApplicationService] Request:",{timestamp:(new Date).toISOString(),method:(null===(t=e.method)||void 0===t?void 0:t.toUpperCase())||"UNKNOWN",url:e.url||"UNKNOWN",headers:e.headers?{...e.headers,Authorization:e.headers.Authorization?"Token [REDACTED]":void 0}:{},data:e.data})},this.logResponse=e=>{console.log("[ApplicationService] Response:",{timestamp:(new Date).toISOString(),status:e.status,statusText:e.statusText,data:e.data})},this.logError=e=>{console.error("[ApplicationService] Error:",{timestamp:(new Date).toISOString(),name:e.name,message:e.message,code:e.code,response:e.response?{status:e.response.status,statusText:e.response.statusText,data:e.response.data}:void 0})},this.handleError=e=>{if(r.A.isAxiosError(e)){var t;const s=e;return{code:s.code||"UNKNOWN_ERROR",message:s.message,details:null===(t=s.response)||void 0===t?void 0:t.data}}return{code:"UNKNOWN_ERROR",message:e instanceof Error?e.message:"An unknown error occurred"}},this.validateSubmission=e=>{const t=[];return e.opportunity||t.push({field:"opportunity",message:"Opportunity ID is required"}),e.user||t.push({field:"user",message:"User ID is required"}),e.answers&&0!==e.answers.length||t.push({field:"answers",message:"At least one answer is required"}),t},this.api.interceptors.request.use((e=>{const t=localStorage.getItem("token");return t&&(e.headers=e.headers||{},e.headers.Authorization=`Token ${t}`),e}))}async getApplicationForm(e){try{const t=await this.api.get(`/opportunity/${e}/application-form/`);return this.logResponse(t),t.data}catch(t){throw this.logError(t),this.handleError(t)}}async submitApplication(e,t){try{const s=localStorage.getItem("user_id");if(!s)throw new Error("User not authenticated");const r={opportunity:e,user:parseInt(s),answers:t},i=this.validateSubmission(r);if(i.length>0)throw{code:"VALIDATION_ERROR",message:"Invalid submission data",details:i};this.logRequest({method:"post",url:`/opportunity/${e}/apply/`,data:r});const o=await this.api.post(`/opportunity/${e}/apply/`,r);return this.logResponse(o),o.data}catch(s){throw this.logError(s),this.handleError(s)}}async getUserApplications(){try{console.log("[ApplicationService] Fetching user applications...");const e=localStorage.getItem("token");console.log("[ApplicationService] Token:",e?"Present":"Missing");const t={method:"get",url:"/applications/",headers:{Authorization:e?`Token ${e}`:void 0}};console.log("[ApplicationService] Request config:",t);const s=await this.api.get("/applications/");return console.log("[ApplicationService] Response data:",s.data),this.logResponse(s),s.data}catch(e){throw console.error("[ApplicationService] Detailed error:",{error:e,message:e instanceof Error?e.message:"Unknown error",response:e instanceof Error&&"response"in e?e.response:void 0}),this.logError(e),this.handleError(e)}}async getOpportunityApplications(e){try{const t=await this.api.get(`/opportunity/${e}/applications/`);return this.logResponse(t),t.data}catch(t){throw this.logError(t),this.handleError(t)}}async updateApplicationStatus(e,t){try{const s=await this.api.put(`/application/${e}/status/`,{status:t});return this.logResponse(s),s.data}catch(s){throw this.logError(s),this.handleError(s)}}}},4478:(e,t,s)=>{s.r(t),s.d(t,{default:()=>H});var r=s(5043),i=s(3216),o=s(6240),n=s(6446),a=s(1637),l=s(4194),d=s(9252),c=s(1906),p=s(3336),u=s(5865),h=s(3845),x=s(9336),m=s(5721),A=s(681),y=s(8734),g=s(3851),j=s(1045),v=s(7784),b=s(7332),S=s(4770),f=s(1082),w=s(7225),E=s(9065),_=s(6291),R=s(1081),q=s(6600),O=s(5316),C=s(3193),T=s(8356),I=s(8982),k=s(2143),D=s(1673),W=s(9413),N=s(4605),P=s(3217),U=s(9347),F=s(9134),$=s(8390),B=s(8158),K=s(3694),z=s(579);const L=e=>{let{open:t,onClose:s,opportunityId:i,opportunityTitle:o}=e;const[d,p]=(0,r.useState)({}),[h,x]=(0,r.useState)(!1),[m,A]=(0,r.useState)(null),[y,g]=(0,r.useState)(!1),[j,b]=(0,r.useState)([]),[S,f]=(0,r.useState)(!1);(0,r.useEffect)((()=>{t&&w()}),[t,i]),(0,r.useEffect)((()=>{t&&(p({}),A(null),g(!1))}),[t]);const w=async()=>{f(!0);try{const e=await K.k.getApplicationForm(i);b(e)}catch(e){console.error("[ApplicationForm] Failed to load application form:",e),b([{id:0,opportunity:i,question_text:"Why are you interested in this opportunity?",question_type:"textarea",is_required:!0,order:0}])}finally{f(!1)}},E=(e,t)=>{const s=t instanceof Date?t.toISOString().split("T")[0]:Array.isArray(t)?JSON.stringify(t):t;p((t=>({...t,[e]:s||""})))},_=e=>{switch(e){case"text":return"Type your answer here...";case"textarea":return"Write your detailed response here...";case"number":return"Enter a number...";case"date":return"Select a date...";case"select":return"Select an option...";case"checkbox":return"Select one or more options...";default:return"Enter your answer..."}};return(0,z.jsxs)(R.A,{open:t,onClose:s,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:2,p:2}},children:[(0,z.jsx)(q.A,{sx:{pb:1},children:(0,z.jsxs)(u.A,{variant:"h5",component:"div",fontWeight:"bold",children:["Apply for ",o]})}),(0,z.jsxs)("form",{onSubmit:e=>{e.preventDefault(),(async()=>{try{x(!0),A(null);const e=Object.entries(d).map((e=>{let[t,s]=e;return{question:parseInt(t),answer:s}}));await K.k.submitApplication(i,e),g(!0),s()}catch(e){const t=e;A(t),console.error("[ApplicationForm] Error submitting application:",t)}finally{x(!1)}})()},children:[(0,z.jsxs)(O.A,{children:[m&&(0,z.jsxs)(l.A,{severity:"error",sx:{mb:2},children:[m.message,m.details&&(0,z.jsx)(n.A,{component:"ul",sx:{mt:1,mb:0,pl:2},children:Array.isArray(m.details)&&m.details.map(((e,t)=>(0,z.jsx)("li",{children:e.message},t)))})]}),y&&(0,z.jsx)(l.A,{severity:"success",sx:{mb:2},children:"Application submitted successfully!"}),S?(0,z.jsx)(n.A,{display:"flex",justifyContent:"center",p:3,children:(0,z.jsx)(a.A,{})}):(0,z.jsx)($.$,{dateAdapter:B.h,children:j.map((e=>{var t,s;return(0,z.jsxs)(n.A,{sx:{mb:3},children:[(0,z.jsxs)(u.A,{variant:"subtitle1",color:"text.secondary",sx:{mb:1},children:[e.question_text,e.is_required&&" *"]}),"date"===e.question_type?(0,z.jsx)(F.l,{value:d[e.id]?new Date(d[e.id]):null,onChange:t=>E(e.id,t),disabled:h,slotProps:{textField:{fullWidth:!0,required:e.is_required,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}}}}):"select"===e.question_type?(0,z.jsxs)(C.A,{fullWidth:!0,required:e.is_required,disabled:h,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}},children:[(0,z.jsx)(T.A,{id:`select-label-${e.id}`,children:"Select an option"}),(0,z.jsx)(I.A,{labelId:`select-label-${e.id}`,value:d[e.id]||"",label:"Select an option",onChange:t=>E(e.id,t.target.value),children:null===(t=e.options)||void 0===t?void 0:t.map(((e,t)=>(0,z.jsx)(k.A,{value:e,children:e},t)))}),e.is_required&&!d[e.id]&&(0,z.jsx)(D.A,{error:!0,children:"This field is required"})]}):"checkbox"===e.question_type?(0,z.jsxs)(W.A,{children:[null===(s=e.options)||void 0===s?void 0:s.map(((t,s)=>{const r=d[e.id]?JSON.parse(d[e.id]):[];return(0,z.jsx)(N.A,{control:(0,z.jsx)(P.A,{checked:r.includes(t),onChange:s=>{const i=s.target.checked?[...r,t]:r.filter((e=>e!==t));E(e.id,i)},disabled:h}),label:t},s)})),e.is_required&&(!d[e.id]||0===JSON.parse(d[e.id]).length)&&(0,z.jsx)(D.A,{error:!0,children:"Please select at least one option"})]}):(0,z.jsx)(v.A,{fullWidth:!0,multiline:"textarea"===e.question_type,rows:"textarea"===e.question_type?4:1,type:"number"===e.question_type?"number":"text",placeholder:_(e.question_type),value:d[e.id]||"",onChange:t=>E(e.id,t.target.value),disabled:h,required:e.is_required,sx:{"& .MuiOutlinedInput-root":{borderRadius:2}}})]},e.id)}))})]}),(0,z.jsxs)(U.A,{sx:{px:3,pb:2},children:[(0,z.jsx)(c.A,{onClick:s,disabled:h||S,sx:{borderRadius:2,textTransform:"none",px:3},children:"Cancel"}),(0,z.jsx)(c.A,{type:"submit",variant:"contained",disabled:h||S||!j.every((e=>!e.is_required||d[e.id]&&""!==d[e.id].trim())),sx:{borderRadius:2,textTransform:"none",px:3},children:h?(0,z.jsx)(a.A,{size:24,color:"inherit"}):"Submit Application"})]})]})]})},H=()=>{const{id:e}=(0,i.g)(),t=(0,i.Zp)(),[s,R]=((0,o.A)(),(0,r.useState)(null)),[q,O]=(0,r.useState)(!0),[C,T]=(0,r.useState)(""),[I,k]=(0,r.useState)(!1),[D,W]=(0,r.useState)(null);(0,r.useEffect)((()=>{e&&N(e)}),[e]);const N=async e=>{try{const t=await _.R0.getOpportunityById(e);R(t)}catch(t){console.error("Error fetching opportunity details:",t),W("Failed to load opportunity details")}finally{O(!1)}};return q?(0,z.jsx)(n.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",children:(0,z.jsx)(a.A,{})}):D||!s?(0,z.jsx)(n.A,{p:3,children:(0,z.jsx)(l.A,{severity:"error",children:D||"Failed to load opportunity details"})}):(0,z.jsxs)(E.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},children:[(0,z.jsx)(n.A,{sx:{minHeight:"100vh"},children:(0,z.jsxs)(d.A,{maxWidth:"lg",sx:{py:6},children:[(0,z.jsx)(c.A,{startIcon:(0,z.jsx)(b.A,{}),onClick:()=>{t(-1)},sx:{mb:2},children:"Back to Opportunities"}),(0,z.jsx)(p.A,{elevation:3,sx:{p:4},children:(0,z.jsxs)(n.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"2fr 1fr"},gap:4},children:[(0,z.jsxs)(n.A,{children:[(0,z.jsx)(u.A,{variant:"h4",gutterBottom:!0,children:s.title}),(0,z.jsxs)(n.A,{sx:{mb:3},children:[(0,z.jsx)(h.A,{icon:(0,z.jsx)(S.A,{}),label:s.organization,sx:{mr:1}}),(0,z.jsx)(h.A,{icon:(0,z.jsx)(f.A,{}),label:s.location,sx:{mr:1}}),(0,z.jsx)(h.A,{icon:(0,z.jsx)(w.A,{}),label:new Date(s.date).toLocaleDateString()})]}),(0,z.jsx)(n.A,{component:"img",src:s.image_url,alt:s.title,sx:{width:"100%",height:"auto",borderRadius:1,mb:3}}),(0,z.jsx)(u.A,{variant:"body1",paragraph:!0,children:s.description}),(0,z.jsx)(x.A,{sx:{my:4}}),(0,z.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:"Requirements"}),(0,z.jsx)(m.A,{children:s.requirements.map(((e,t)=>(0,z.jsx)(A.Ay,{children:(0,z.jsx)(y.A,{primary:e})},t)))}),(0,z.jsx)(x.A,{sx:{my:4}}),(0,z.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:"Participants"}),(0,z.jsx)(m.A,{children:s.participants.map((e=>(0,z.jsxs)(A.Ay,{children:[(0,z.jsx)(g.A,{children:(0,z.jsx)(j.A,{src:e.profile_picture})}),(0,z.jsx)(y.A,{primary:e.username})]},e.id)))})]}),(0,z.jsx)(n.A,{children:(0,z.jsxs)(p.A,{elevation:2,sx:{p:3},children:[(0,z.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:"Join this Opportunity"}),(0,z.jsx)(c.A,{variant:"contained",fullWidth:!0,sx:{mb:3},onClick:()=>k(!0),children:"Sign Up"}),(0,z.jsx)(x.A,{sx:{my:3}}),(0,z.jsx)(u.A,{variant:"h6",gutterBottom:!0,children:"Comments"}),(0,z.jsxs)(n.A,{component:"form",onSubmit:async e=>{e.preventDefault(),T("")},children:[(0,z.jsx)(v.A,{fullWidth:!0,multiline:!0,rows:3,placeholder:"Add a comment...",value:C,onChange:e=>T(e.target.value),sx:{mb:2}}),(0,z.jsx)(c.A,{type:"submit",variant:"contained",fullWidth:!0,disabled:!C.trim(),children:"Post Comment"})]})]})})]})})]})}),(0,z.jsx)(L,{open:I,onClose:()=>k(!1),opportunityId:parseInt(e||"0"),opportunityTitle:s.title})]})}}}]);
//# sourceMappingURL=478.0098115c.chunk.js.map